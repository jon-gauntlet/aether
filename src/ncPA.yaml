---
# Parser configurations for security findings ETL

# Configuration Best Practices
# 1. Use skip_on_error strategically for production vs development
# 2. Preserve tool-specific fields for traceability
# 3. Define required fields based on schema requirements
# 4. Use consistent patterns for file matching
# 5. Configure source directories relative to workspace

# Common settings
defaults: &defaults
  skip_on_error: false  # Default to strict parsing
  preserve_source_data: true  # Keep original findings for reference
  preserve_fields:  # Common fields to preserve across all tools
    - original_id
    - original_severity
    - original_category
    - tool_specific_data

# SAST parser configurations
bearer:
  <<: *defaults
  source_dir: findings/sast
  file_pattern: "bearer.json"
  required_fields:  # Title/description required for clear findings
    - id
    - title
    - description
  preserve_fields:  # Bearer-specific fields
    - rule_id
    - categories
    - tags
    - documentation_url
  # Note: Severity determined by list location in Bearer output

brakeman:
  <<: *defaults
  source_dir: findings/sast
  file_pattern: "brakeman.json"
  required_fields:  # Code location essential for Rails findings
    - warning_type
    - message
    - file
    - line
    - code
  preserve_fields:  # Rails-specific metadata
    - warning_code
    - fingerprint
    - confidence
    - user_input
    - render_path

snyk:
  <<: *defaults
  source_dir: findings/sast
  file_pattern: "snyk-*.json"
  required_fields:
    - id
    - title
    - package
    - version
  preserve_fields:  # Dependency-specific data
    - from
    - upgrade_path
    - is_upgradeable
    - cvss_score
    - package_manager

# DAST parser configurations
nikto:
  <<: *defaults
  source_dir: findings/dast
  file_pattern: "nikto.json"
  required_fields:  # URL components handled in parser
    - id
    - message
  preserve_fields:  # Network-level details
    - osvdb
    - method
    - port
    - ssl

wapiti:
  <<: *defaults
  source_dir: findings/dast
  file_pattern: "wapiti.json"
  required_fields:  # Classification-based findings
    - type
    - description
    - solution
    - references
  preserve_fields:  # Request-specific data
    - module
    - parameter
    - info
    - http_request

zap:
  <<: *defaults
  source_dir: findings/dast/zaproxy
  file_pattern: "*.json"
  required_fields:  # Instance-based findings
    - alert
    - risk
    - confidence
    - url
  preserve_fields:  # Attack evidence
    - pluginid
    - other
    - attack
    - evidence
    - instances

burpsuite:
  <<: *defaults
  source_dir: findings/dast
  file_pattern: "burpsuite.json"
  required_fields:
    - issue_name
    - severity
    - confidence
  preserve_fields:  # Detailed HTTP data
    - request_response
    - serialized_issue
    - remediation_background

# LLM parser configurations
claude:
  <<: *defaults
  source_dir: findings/claude-3.5-sonnet
  file_pattern: "*.json"
  required_fields:  # Complete finding structure
    - id
    - title
    - description
    - security_category
    - severity
    - finding_type
  preserve_fields:  # AI-specific metadata
    - evidence
    - remediation
    - related_findings
    - metadata 