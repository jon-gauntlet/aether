#!/bin/bash

# Colors for output
GREEN='\033[0;32m'
RED='\033[0;31m'
NC='\033[0m'

# Function to test sudo command
test_sudo() {
    local cmd="$1"
    local desc="$2"
    if sudo -n $cmd > /dev/null 2>&1; then
        echo -e "${GREEN}✓${NC} $desc"
        return 0
    else
        echo -e "${RED}✗${NC} $desc"
        return 1
    fi
}

# Test core optimization commands
echo "Testing core optimization commands..."
test_sudo "/home/jon/scripts/cursor/cursor-optimize cpupower" "CPU governor control"
test_sudo "/home/jon/scripts/cursor/cursor-optimize sysctl vm.swappiness=1" "Sysctl control"
test_sudo "/home/jon/scripts/cursor/cursor-optimize optimize $$" "Process optimization"
test_sudo "/home/jon/scripts/cursor/cursor-optimize verify $$" "Process verification"

# Test direct commands
echo -e "\nTesting direct command access..."
test_sudo "chrt -f -p 50 $$" "Process scheduling"
test_sudo "renice -n -10 -p $$" "Process priority"
test_sudo "ionice -c 1 -n 0 -p $$" "IO priority"
test_sudo "taskset -pc 0-7 $$" "CPU affinity"
test_sudo "cpupower frequency-set -g performance" "CPU frequency"

# Test systemd controls
echo -e "\nTesting systemd controls..."
test_sudo "systemctl daemon-reload" "Systemd reload"
test_sudo "systemctl status cursor-context.slice" "Systemd status"

# Test file operations
echo -e "\nTesting file operations..."
test_sudo "cp /home/jon/scripts/cursor/cursor-optimize /etc/systemd/system/" "System file copy"
test_sudo "chmod +x /home/jon/scripts/cursor/cursor-optimize" "Permission setting"
test_sudo "chown jon:jon /home/jon/.local/share/cursor" "Ownership setting"

# Test monitoring access
echo -e "\nTesting monitoring access..."
test_sudo "cat /proc/sys/vm/swappiness" "Sysctl reading"
test_sudo "cat /proc/sys/kernel/sched_latency_ns" "Scheduler reading"

# Summary
echo -e "\nVerification complete!" 