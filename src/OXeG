#!/bin/bash

# Focus Timer
duration=${1:-25}  # Default to 25 minutes if no argument provided
TIMER_STATE="$HOME/.cache/cursor/timer_state"

mkdir -p "$(dirname "$TIMER_STATE")"

# Convert minutes to seconds
seconds=$((duration * 60))

# Start timer
echo "$(date +%s):$seconds" > "$TIMER_STATE"
notify-send "Focus Timer Started" "${duration} minutes"

# Main timer loop
while [ $seconds -gt 0 ]; do
    # Update state file
    echo "$(date +%s):$seconds" > "$TIMER_STATE"
    
    # Show progress every 5 minutes
    if [ $((seconds % 300)) -eq 0 ]; then
        minutes=$((seconds / 60))
        notify-send "Focus Timer" "${minutes} minutes remaining"
    fi
    
    sleep 60
    seconds=$((seconds - 60))
done

# Timer complete
rm "$TIMER_STATE"
notify-send "Focus Timer Complete" "Time for a break!"
paplay /usr/share/sounds/freedesktop/stereo/complete.oga 2>/dev/null 