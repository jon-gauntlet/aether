# Rails Security Guide Notes
[src](https://guides.rubyonrails.org/security.html)

Skim headings, then read thoroughly.

Headings:
1. Introduction
2. Sessions
3. Cross-Site Request Forgery (CSRF)
4. Redirection and Files
5. User Management
6. Injection
7. Unsafe Query Generation
8. HTTP Security Headers
9. Intranet and Admin Security
10. Environmental Security
11. Dependency Management and CVEs
12. Additional Resources



Notes: 
- Section 4 includes "file uploads" which is a functionality of the application (@codebase[app]])
- Section 5 includes Privilege Escalation which I should test on the application (@codebase[app]])


## 2. Sessions
Absolutely! Here's a summary of the key points from the Sessions section of the Rails Security Guide, with considerations for your @project[app]:

### 2.1 What are Sessions?
- Sessions allow applications to maintain user-specific state while the user interacts with the app
- Rails provides a session object for each user that accesses the application
- Session data is stored using `ActionDispatch::Session::CookieStore` by default in Rails

### 2.2 Session Hijacking
- Stealing a user's session ID lets an attacker use the web app as that user
- Countermeasures:
  - _Always use HTTPS_ - set `config.force_ssl = true` 
  - Provide a _log out button_ and make it prominent
  - Protect against cross-site scripting (XSS) which can be used to steal cookies

### 2.3 Session Storage
- Rails uses `ActionDispatch::Session::CookieStore` by default to store session hash in a cookie on the client-side
- Cookies have a 4KB size limit, so store only minimal data
- Cookies can be read by the client, so avoid storing sensitive data
- To secure cookies, Rails encrypts them by default using the app's `secret_key_base`

### 2.4 Rotating Encrypted and Signed Cookies Configurations
- Rails allows rotating the ciphers and digests used for encrypted and signed cookies
- Rotation enables seamless migration to new algorithms while allowing old cookies to still be read and eventually upgraded

### 2.5 Replay Attacks for CookieStore Sessions
- Attacker can copy a cookie and submit it later to replay the session 
- Countermeasure: Don't store sensitive data like credit in a cookie, store it server-side instead

### 2.6 Session Fixation
- Attacker forces user's browser to use a session ID known to the attacker
- Vulnerable if authenticating based on session ID alone

### 2.7 Session Fixation - Countermeasures
- _Reset the session_ with `reset_session` after successful login
- This generates a new session ID not known to the attacker

For your @project[app], the key recommendations are:

1. Ensure your app forces HTTPS in production with `config.force_ssl = true`

2. Provide a prominent log out button that resets the session

3. Be aware of XSS vulnerabilities that could allow session hijacking 

4. Avoid storing sensitive data in session cookies, use server-side storage

5. After successful login, reset the session to invalidate fixated session IDs

6. Protect your `secret_key_base` used to encrypt session cookies

Let me know if you would like me to elaborate on any part of the Sessions section or if you have additional questions! I'm happy to help you ensure your application follows Rails security best practices.



