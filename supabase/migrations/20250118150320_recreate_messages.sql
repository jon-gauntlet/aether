-- Drop and recreate messages table\ndrop table if exists messages cascade;\ncreate table messages (\n  id uuid default gen_random_uuid() primary key,\n  content text not null,\n  channel text not null default 'general',\n  user_id text not null,\n  coherence_level numeric not null default 0,\n  energy_level numeric not null default 0,\n  created_at timestamp with time zone default timezone('utc'::text, now()),\n  updated_at timestamp with time zone default timezone('utc'::text, now())\n);\n\n-- Enable RLS\nalter table messages enable row level security;\n\n-- Create policy for reading messages\ncreate policy "Users can read messages in their channels"\n  on messages for select\n  to authenticated\n  using (true);\n\n-- Create policy for inserting messages\ncreate policy "Users can insert messages"\n  on messages for insert\n  to authenticated\n  with check (auth.uid()::text = user_id);\n\n-- Enable real-time\nalter publication supabase_realtime add table messages;
